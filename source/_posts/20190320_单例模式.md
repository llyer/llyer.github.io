---
title: 单例模式
date: 2019-03-20 21:39:44
tags:
    - Java
    - 设计模式
---

单例模式的集中实现方式：

- 懒汉式 lazyLoading，线程不安全
- 懒汉线程安全 同时满足效率低
- 饿汉式  最简单，最值得使用 threadSafe
- 登记式/内部静态类的方法 threadSafe lazyLoading 同时满足
- 没写的双重锁和枚举

``` java
/**
 * 饿汉式
 * 懒加载初始化：false
 * 多线程安全： true
 * 实现简单程度：易
 * 
 * 优点：类加载时实例化对象，实现方式简单，并且没有多线程的安全性问题，
 * 缺点：就是在类加载的时候就实例化了对象，不管是否使用都会占用内存，但是如果没有特别明确的需求建议使用此种方法
 * 
 */
public class Singleton {
	
	private static Singleton single = new Singleton();
	
	private Singleton(){}
	
	public static Singleton getSingleton () {
		return single;
	}
	
	public void hello() {
		System.out.println("hello,world");
	}

}
```

``` java
/**
 * 懒汉式
 * 懒加载初始化：true
 * 多线程安全： false
 * 实现简单程度：易
 * 
 * 优点：实现方式简单，实现了lazyloading
 * 缺点：线程不安全，不支持多线程。没有加锁synchronized。严格意义不算是单利模式
 * 
 * 课后作业：测试一下多线程下的安全问题是如何出现的
 * 
 */
public class SingletonLazyThreadUnsafe {
	
	private static SingletonLazyThreadUnsafe single;
	
	private SingletonLazyThreadUnsafe(){}
	
	public static SingletonLazyThreadUnsafe getSingleton () {
		if (single == null) {
			return new SingletonLazyThreadUnsafe();
		}
		return single;
	}
	
	public void hello() {
		System.out.println("hello,world");
	}

}
```

``` java
/**
 * 懒汉式线程安全版
 * 懒加载初始化：true
 * 多线程安全： true
 * 实现简单程度：易
 * 
 * 优点：实现方式简单，实现了lazyloading，可以在多线程中工作，但是效率很低，大概率情况下不需要同步
 * 缺点：加锁 synchronized 才能保证运行，并且项目对getInstance的效率要求并不是很高
 * 
 */
public class SingletonLazyThredSafe {
	
	private static SingletonLazyThredSafe single;
	
	private SingletonLazyThredSafe(){}
	
	public static synchronized SingletonLazyThredSafe getSingleton () {
		if (single == null) {
			return new SingletonLazyThredSafe();
		}
		return single;
	}
	
	public void hello() {
		System.out.println("hello,world");
	}

}
```

``` java
/**
 * 登记式/静态内部类
 * 懒加载初始化：true
 * 多线程安全： true
 * 实现简单程度：中
 * 
 * 优点：lazyloading，threadSafe
 * 缺点：加锁 synchronized 才能保证运行，并且项目对getInstance的效率要求并不是很高
 * 
 * 描述：同样使用类加载机制保证初始化instance时，只有一个线程。在实现线程安全的同时，实现了懒加载，更加节省了资源
 */
public class SingletonLazyInnerClass {
	
	public static class SingletonHolder {
		private static SingletonLazyInnerClass single = new SingletonLazyInnerClass();
	}
	
	private SingletonLazyInnerClass(){}
	
	public static SingletonLazyInnerClass getSingleton () {
			return SingletonHolder.single;
	}
	
	public void hello() {
		System.out.println("hello,world");
	}

}
```


调用示例

``` java
public class Main {
	
	public static void main(String[] args) {
		Singleton single = Singleton.getSingleton();
		single.hello();
	}

}
```

~~~

***